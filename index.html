<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Izu Coastal Radar | Debug Mode</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background: #f4f6f7; color: #333; margin: 0; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .error-box { 
            background: #fee2e2; border: 2px solid #ef4444; color: #b91c1c; 
            padding: 20px; border-radius: 8px; font-family: monospace; 
            margin-top: 50px; white-space: pre-wrap;
        }
        h1 { text-align: center; color: #006C70; }
        .loading { text-align: center; font-size: 1.2em; color: #666; margin-top: 50px; }
    </style>
</head>
<body>

<div class="container">
    <h1>Izu Coastal Radar (Debug Mode)</h1>
    <div id="status" class="loading">Attempting to load data...</div>
    <div id="error-output" style="display:none;" class="error-box"></div>
</div>

<script>
    async function runDiagnostics() {
        const status = document.getElementById('status');
        const errBox = document.getElementById('error-output');
        
        try {
            // Step 1: Check if file exists
            status.textContent = "Step 1: Fetching listings.json...";
            const response = await fetch('listings.json?v=' + Date.now());
            
            if (!response.ok) {
                throw new Error(`FILE NOT FOUND\nServer returned: ${response.status} ${response.statusText}\n\nCheck:\n1. Is the file named 'listings.json' exactly (all lowercase)?\n2. Is it in the root folder (not in a subfolder)?`);
            }

            // Step 2: Check if JSON is valid
            status.textContent = "Step 2: Parsing JSON data...";
            const text = await response.text(); // Get raw text first
            
            try {
                const json = JSON.parse(text);
                
                // If we get here, it worked!
                document.body.innerHTML = "<h2 style='text-align:center; color:green; margin-top:50px;'>SUCCESS! Data loaded correctly.</h2><p style='text-align:center'>The file is valid. You can restore the main index.html now.</p>";
                console.log("Data loaded:", json);
                
            } catch (jsonError) {
                // If JSON is broken, show the first few lines of what we got instead
                const preview = text.substring(0, 200).replace(/</g, "&lt;");
                throw new Error(`INVALID JSON FORMAT\nThe file exists but contains bad data.\n\nError: ${jsonError.message}\n\nFile Preview (First 200 chars):\n${preview}...`);
            }

        } catch (e) {
            status.style.display = 'none';
            errBox.style.display = 'block';
            errBox.innerHTML = `<strong>CRITICAL ERROR:</strong>\n${e.message}`;
        }
    }

    runDiagnostics();
</script>
</body>
</html>
