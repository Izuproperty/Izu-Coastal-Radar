<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Izu Coastal Radar</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #006C70; --accent: #FF5A5F; --bg: #F4F6F7; --card-bg: #FFFFFF;
            --text-main: #2A2A33; --text-light: #585858; --border: #D1D1D5;
        }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text-main); margin: 0; }

        /* VINTAGE HEADER */
        header { background: #fff; border-bottom: 1px solid var(--border); }
        .vintage-hero { 
            display: flex; gap: 15px; padding: 30px; overflow-x: auto; 
            background: #FDFBF7; justify-content: center;
        }
        .poster-frame { 
            height: 220px; flex-shrink: 0; border: 6px solid #fff; 
            box-shadow: 0 4px 8px rgba(0,0,0,0.15); transition: transform 0.2s; 
        }
        .poster-frame:hover { transform: scale(1.02); z-index: 10; }
        .poster-frame img { height: 100%; width: auto; display: block; }
        
        .header-content { text-align: center; padding: 30px 20px; }
        h1 { margin: 0; font-size: 2.2rem; font-weight: 700; color: var(--primary); }
        .subtitle { color: var(--text-light); margin-top: 5px; font-weight: 400; }

        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }

        /* STATS */
        .stats-bar { 
            display: flex; gap: 20px; flex-wrap: wrap; background: white; padding: 20px; 
            border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); 
            margin-bottom: 30px; justify-content: space-around;
        }
        .stat-item { text-align: center; }
        .stat-val { font-size: 1.5rem; font-weight: 700; color: var(--primary); }
        .stat-label { font-size: 0.85rem; color: var(--text-light); text-transform: uppercase; letter-spacing: 0.5px; }
        .stat-sub { font-size: 0.8rem; color: #888; }

        /* CONTROLS */
        .controls { 
            background: white; padding: 15px 20px; border-radius: 8px; border: 1px solid var(--border);
            display: flex; flex-wrap: wrap; gap: 15px; align-items: center; margin-bottom: 20px;
            position: sticky; top: 0; z-index: 100; box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        select { padding: 8px 12px; border: 1px solid #ccc; border-radius: 4px; font-size: 0.9rem; }
        .toggle-btn { padding: 8px 16px; border: 1px solid var(--primary); background: white; color: var(--primary); border-radius: 4px; cursor: pointer; font-weight: 600; }
        .toggle-btn.active { background: var(--primary); color: white; }
        .results-count { margin-left: auto; font-weight: 600; color: var(--text-light); }

        /* GRID */
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 30px; }
        .card { 
            background: white; border-radius: 8px; overflow: hidden; border: 1px solid var(--border);
            transition: box-shadow 0.2s; display: flex; flex-direction: column;
        }
        .card:hover { box-shadow: 0 10px 20px rgba(0,0,0,0.1); }

        .card-img-container { height: 220px; position: relative; background: #eee; }
        .card-img { width: 100%; height: 100%; object-fit: cover; }
        
        .card-body { padding: 20px; flex-grow: 1; display: flex; flex-direction: column; }
        .card-price { font-size: 1.75rem; font-weight: 700; color: var(--text-main); }
        .card-title { font-size: 1.1rem; font-weight: 600; color: var(--primary); text-decoration: none; margin: 5px 0 10px; }
        .card-specs { display: flex; gap: 15px; margin-bottom: 15px; font-weight: 500; }
        .spec-item span { font-weight: 400; color: var(--text-light); font-size: 0.9rem; }
        .card-footer { margin-top: auto; padding-top: 15px; border-top: 1px solid #eee; font-size: 0.85rem; color: var(--text-light); }
        
        .card-tags { margin-top: 10px; display: flex; gap: 5px; flex-wrap: wrap; }
        .tag { background: #e0f2f1; color: var(--primary); padding: 4px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; }
        .tag.sea-view { background: #e3f2fd; color: #0277bd; }
    </style>
</head>
<body>

<header>
    <div class="vintage-hero">
        <div class="poster-frame"><img src="assets/images/17E88B82-01F3-4A60-9571-935741E304B9.jpeg"></div>
        <div class="poster-frame"><img src="assets/images/42DD5202-2825-48D4-BC01-1AF67FD8BFBE.jpeg"></div>
        <div class="poster-frame"><img src="assets/images/57D6E8AA-D359-417A-AB92-037676775478.jpeg"></div>
        <div class="poster-frame"><img src="assets/images/715105E4-F9EB-405D-A0E4-3D0C8C82EDE6.jpeg"></div>
        <div class="poster-frame"><img src="assets/images/F62A2A51-B69F-4496-9061-1020FDC053B9.jpeg"></div>
    </div>
    <div class="header-content">
        <h1>Izu Coastal Radar</h1>
        <div class="subtitle">Market Intelligence for Shimoda & Minami-Izu</div>
    </div>
</header>

<div class="container">
    <div class="stats-bar" id="stats-panel" style="display:none">
        <div class="stat-item"><div class="stat-val" id="stat-price">-</div><div class="stat-label" id="lbl-price">Avg Price</div></div>
        <div class="stat-item"><div class="stat-val" id="stat-size">-</div><div class="stat-label" id="lbl-size">Avg Size</div></div>
        <div class="stat-item"><div class="stat-val" id="stat-unit">-</div><div class="stat-label" id="lbl-unit">Price/Unit</div><div class="stat-sub" id="stat-unit-sub">-</div></div>
    </div>

    <div class="controls">
        <button class="toggle-btn active" id="btn-en" onclick="setLang('EN')">EN</button>
        <button class="toggle-btn" id="btn-jp" onclick="setLang('JP')">JP</button>
        <div style="width:1px; height:20px; background:#ddd; margin:0 10px;"></div>
        <button class="toggle-btn active" id="btn-jpy" onclick="setCurr('JPY')">JPY</button>
        <button class="toggle-btn" id="btn-usd" onclick="setCurr('USD')">USD</button>

        <select id="loc-select" onchange="render()"><option value="all">All Locations</option></select>
        <select id="type-select" onchange="render()">
            <option value="all">All Types</option>
            <option value="house">House</option>
            <option value="mansion">Mansion</option>
            <option value="land">Land</option>
        </select>
        <select id="seaview-select" onchange="render()">
            <option value="all">Any View</option>
            <option value="4">Strong View</option>
            <option value="5">Ocean Front</option>
        </select>
        <select id="sort-select" onchange="render()">
            <option value="price-desc">Price: High-Low</option>
            <option value="price-asc">Price: Low-High</option>
            <option value="size-desc">Size: Large-Small</option>
            <option value="age-desc">Age: Newest</option>
        </select>
        <div class="results-count" id="count-display"></div>
    </div>

    <div class="grid" id="grid">Loading...</div>
</div>

<script>
    let DATA = { listings: [], rate: 155 };
    let STATE = { lang: 'EN', curr: 'JPY', loc: 'all', sort: 'price-desc', type: 'all', view: 'all' };
    const PROXY = "https://wsrv.nl/?url=";
    const LOC_MAP = { "ä¸‹ç”°å¸‚": "Shimoda City", "ä¼Šæ±å¸‚": "Ito City", "æ±ä¼Šè±†ç”º": "Higashi-Izu Town", "æ²³æ´¥ç”º": "Kawazu Town", "å—ä¼Šè±†ç”º": "Minami-Izu Town" };

    const TXT = {
        'EN': { avgP: "Avg Price", avgS: "Avg Size", unit: "Price/Unit", built: "Built", upd: "Updated", locAll: "All Locations" },
        'JP': { avgP: "å¹³å‡ä¾¡æ ¼", avgS: "å¹³å‡é¢ç©", unit: "å˜ä¾¡", built: "ç¯‰å¹´", upd: "æ›´æ–°", locAll: "å…¨åœ°åŸŸ" }
    };

    async function init() {
        try {
            const res = await fetch('listings.json');
            const json = await res.json();
            DATA.listings = json.listings;
            DATA.rate = json.fxRate || 155;
            populateLocations();
            render();
        } catch (e) {
            document.getElementById('grid').innerHTML = "Failed to load data.";
        }
    }

    function setLang(l) { STATE.lang = l; document.getElementById('btn-en').className = l==='EN'?'toggle-btn active':'toggle-btn'; document.getElementById('btn-jp').className = l==='JP'?'toggle-btn active':'toggle-btn'; render(); }
    function setCurr(c) { STATE.curr = c; document.getElementById('btn-jpy').className = c==='JPY'?'toggle-btn active':'toggle-btn'; document.getElementById('btn-usd').className = c==='USD'?'toggle-btn active':'toggle-btn'; render(); }

    function populateLocations() {
        const sel = document.getElementById('loc-select');
        const cities = [...new Set(DATA.listings.map(l => l.city))].sort();
        cities.forEach(c => sel.innerHTML += `<option value="${c}">${c}</option>`);
    }

    function fmtPrice(v) {
        if (!v) return "N/A";
        return STATE.curr === 'JPY' 
            ? "Â¥" + (v/1000000).toFixed(1) + "M"
            : "$" + Math.round(v / DATA.rate).toLocaleString();
    }

    function render() {
        const t = TXT[STATE.lang];
        STATE.loc = document.getElementById('loc-select').value;
        STATE.type = document.getElementById('type-select').value;
        STATE.view = document.getElementById('seaview-select').value;
        STATE.sort = document.getElementById('sort-select').value;

        // Filter
        let items = DATA.listings.filter(l => {
            return (STATE.loc === 'all' || l.city === STATE.loc) &&
                   (STATE.type === 'all' || l.propertyType === STATE.type) &&
                   (STATE.view === 'all' || (STATE.view === '4' && l.seaViewScore >= 4) || (STATE.view === '5' && l.seaViewScore === 5));
        });

        // Sort
        items.sort((a,b) => {
            if (STATE.sort === 'price-desc') return (b.priceJpy||0) - (a.priceJpy||0);
            if (STATE.sort === 'price-asc') return (a.priceJpy||0) - (b.priceJpy||0);
            if (STATE.sort === 'size-desc') return (b.buildingSqm||0) - (a.buildingSqm||0);
            if (STATE.sort === 'age-desc') return (a.age||999) - (b.age||999);
        });

        // Stats
        const avgP = items.length ? items.reduce((s,i)=>s+(i.priceJpy||0),0)/items.length : 0;
        const avgS = items.length ? items.reduce((s,i)=>s+(i.buildingSqm||0),0)/items.length : 0;
        
        document.getElementById('stats-panel').style.display = 'flex';
        document.getElementById('lbl-price').innerText = t.avgP;
        document.getElementById('stat-price').innerText = fmtPrice(avgP);
        document.getElementById('lbl-size').innerText = t.avgS;
        document.getElementById('stat-size').innerText = Math.round(avgS) + " mÂ²";
        document.getElementById('lbl-unit').innerText = t.unit;
        
        if (STATE.curr === 'JPY') {
            const val = avgS ? Math.round((avgP/avgS)/10000) : 0;
            document.getElementById('stat-unit').innerText = "Â¥" + val + "ä¸‡";
            document.getElementById('stat-unit-sub').innerText = "/ mÂ²";
        } else {
            const val = (avgS && DATA.rate) ? Math.round((avgP/DATA.rate)/(avgS*10.764)) : 0;
            document.getElementById('stat-unit').innerText = "$" + val;
            document.getElementById('stat-unit-sub').textContent = "/ sqft";
        }

        // Grid
        const grid = document.getElementById('grid');
        grid.innerHTML = "";
        document.getElementById('count-display').innerText = items.length + " Listings";

        if (items.length === 0) grid.innerHTML = "<p class='no-listings'>No results found.</p>";

        items.forEach(l => {
            const title = STATE.lang === 'EN' ? (l.titleEn || l.title) : l.title;
            const img = l.imageUrl ? PROXY + encodeURIComponent(l.imageUrl) : "https://via.placeholder.com/400x300?text=No+Image";
            
            let details = [];
            if (l.yearBuilt) details.push(`<span>${t.built}: ${l.yearBuilt}</span>`);
            if (l.lastUpdated) details.push(`<span>${t.upd}: ${l.lastUpdated}</span>`);

            grid.innerHTML += `
            <div class="card">
                <div class="card-img-container">
                    <a href="${l.sourceUrl}" target="_blank"><img src="${img}" class="card-img" loading="lazy"></a>
                </div>
                <div class="card-body">
                    <div class="card-price">${fmtPrice(l.priceJpy)}</div>
                    <div class="card-specs">
                        <div class="spec-item"><strong>${l.buildingSqm || '-'}</strong> <span>mÂ²</span></div>
                        <div class="spec-item"><strong>${l.landSqm || '-'}</strong> <span>land</span></div>
                    </div>
                    <a href="${l.sourceUrl}" target="_blank" class="card-title">${title}</a>
                    <div class="card-footer">${details.join(' &bull; ')}</div>
                    <div class="card-tags">
                        ${l.highlightTags.map(tag => tag==='Sea View'?'':`<span class="tag">${tag}</span>`).join('')}
                        ${l.seaViewScore >=4 ? '<span class="tag sea-view">ðŸŒŠ Sea View</span>' : ''}
                    </div>
                </div>
            </div>`;
        });
    }

    init();
</script>
</body>
</html>
